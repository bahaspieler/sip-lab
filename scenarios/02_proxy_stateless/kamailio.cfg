#!KAMAILIO
#
# Scenario 02 â€” Minimal Stateless Proxy
#
# Forwards SIP requests based on the Request-URI using core forward().
# No transaction state is kept. Responses follow Via headers back.

debug=2
log_stderror=yes
fork=yes
children=2
auto_aliases=no

listen=udp:172.20.0.10:5060

mpath="/usr/lib/kamailio/modules/"

loadmodule "sl.so"
loadmodule "maxfwd.so"
loadmodule "pv.so"

request_route {
    # Max-Forwards check: prevent loops
    if (!maxfwd_process("10")) {
        sl_send_reply("483", "Too Many Hops");
        exit;
    }

    # Stateless forward based on Request-URI
    # Kamailio adds its own Via header, resolves R-URI, and sends
    forward();
}
